<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>إدارة الدورة الذكية | Poultry ERP</title>
    
    <!-- PWA Meta -->
    <meta name="theme-color" content="#334155">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" id="manifest-placeholder">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { primary: '#10b981', secondary: '#3b82f6', darkbg: '#0f172a', darkcard: '#1e293b', surface: '#334155', danger: '#ef4444', warning: '#f59e0b' },
                    fontFamily: { sans: ['Tajawal', 'sans-serif'] }
                }
            }
        }
    </script>

    <!-- Assets -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">

    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body class="bg-darkbg text-gray-300 h-screen flex flex-col overflow-hidden pb-safe">

    <!-- 0. SPLASH SCREEN -->
    <div id="splashScreen" class="fixed inset-0 z-50 bg-gray-900 flex flex-col items-center justify-center text-primary transition-opacity duration-700">
        <div class="w-24 h-24 bg-surface rounded-full flex items-center justify-center shadow-2xl shadow-primary/20">
            <i class="fa-solid fa-feather-pointed text-4xl"></i>
        </div>
        <h1 class="text-3xl font-bold tracking-wider mt-6">دواجن ERP</h1>
        <p class="text-slate-500 font-bold tracking-widest text-sm mt-2">Single Farm Edition</p>
    </div>

    <!-- 1. APP CONTAINER -->
    <div id="appContainer" class="hidden flex-1 flex flex-col overflow-hidden">
        
        <!-- Header -->
        <header class="bg-surface shadow-lg px-4 py-3 flex justify-between items-center z-20">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-surface border border-gray-700 rounded-lg flex items-center justify-center text-primary">
                    <i class="fa-solid fa-house-chimney"></i>
                </div>
                <div>
                    <h1 id="headerTitle" class="text-lg font-bold text-white leading-none">لوحة التحكم</h1>
                    <span id="headerCycle" class="text-xs text-slate-500">دورة يناير 24</span>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="App.router('notifications')" class="relative w-10 h-10 rounded-full bg-gray-700 border border-gray-600 flex items-center justify-center text-slate-300 hover:bg-gray-600 hover:text-white transition">
                    <i class="fa-solid fa-bell"></i>
                    <span id="notifBadge" class="hidden absolute -top-1 -right-1 w-3 h-3 bg-danger rounded-full"></span>
                </button>
                <button onclick="App.router('settings')" class="w-10 h-10 rounded-full bg-gray-700 border border-gray-600 flex items-center justify-center text-slate-300 hover:bg-gray-600 hover:text-white transition">
                    <i class="fa-solid fa-cog"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main id="mainContent" class="flex-1 overflow-y-auto p-4 scroll-smooth"></main>

        <!-- Bottom Navigation -->
        <nav id="mainNav" class="bg-surface border-t border-gray-800 fixed bottom-0 w-full h-20 flex justify-around items-center z-30 pb-safe">
            <button onclick="App.router('dashboard')" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-primary active:text-primary" data-target="dashboard"><i class="fa-solid fa-chart-line text-xl mb-1"></i><span class="text-[10px] font-bold">لوحة</span></button>
            <button onclick="App.router('production')" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-primary" data-target="production"><i class="fa-solid fa-clipboard-list text-xl mb-1"></i><span class="text-[10px] font-bold">الإنتاج</span></button>
            <button onclick="App.router('inventory')" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-primary" data-target="inventory"><i class="fa-solid fa-boxes-stacked text-xl mb-1"></i><span class="text-[10px] font-bold">المخزون</span></button>
            <button onclick="App.router('finance')" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-primary" data-target="finance"><i class="fa-solid fa-coins text-xl mb-1"></i><span class="text-[10px] font-bold">المالية</span></button>
            <button onclick="App.router('health')" class="nav-item flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-primary" data-target="health"><i class="fa-solid fa-heart-pulse text-xl mb-1"></i><span class="text-[10px] font-bold">الصحة</span></button>
        </nav>

        <button id="backBtn" onclick="App.goBack()" class="fixed top-4 left-4 z-40 w-10 h-10 bg-surface border border-gray-700 rounded-full shadow-lg flex items-center justify-center text-slate-300 hover:text-white hidden"><i class="fa-solid fa-arrow-right"></i></button>
    </div>

    <!-- Modals -->
    <!-- Mortality Cause Modal -->
    <div id="mortalityModal" class="fixed inset-0 z-50 hidden">
        <div class="modal-overlay absolute inset-0" onclick="App.closeModal('mortalityModal')"></div>
        <div class="absolute bottom-0 w-full bg-surface p-6 rounded-t-2xl shadow-2xl border-t border-gray-700">
            <h3 class="text-xl font-bold text-white mb-4">تحديد سبب النفوق</h3>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="Actions.saveMortality('ضعف عند الفقس')" class="bg-gray-800 p-3 rounded-xl text-white text-sm font-bold border border-gray-600">ضعف عند الفقس</button>
                <button onclick="Actions.saveMortality('تجويع عصبي')" class="bg-gray-800 p-3 rounded-xl text-white text-sm font-bold border border-gray-600">تجويع عصبي</button>
                <button onclick="Actions.saveMortality('التهوية الحرارية')" class="bg-gray-800 p-3 rounded-xl text-white text-sm font-bold border border-gray-600">التهوية الحرارية</button>
                <button onclick="Actions.saveMortality('أمراض معدي')" class="bg-gray-800 p-3 rounded-xl text-white text-sm font-bold border border-gray-600">أمراض معدي</button>
                <button onclick="Actions.saveMortality('تسمم غذائي')" class="bg-gray-800 p-3 rounded-xl text-white text-sm font-bold border border-gray-600">تسمم غذائي</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="database.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(reg => console.log('SW Registered')).catch(err => console.log('SW Fail', err));
        }
    </script>
    <script src="app.js"></script>
</body>
    </html>
